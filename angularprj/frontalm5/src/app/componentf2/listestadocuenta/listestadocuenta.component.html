<div class="container mt-4">
  <h3>ðŸ“„ Estado de Cuenta</h3>

  <!-- Input de bÃºsqueda -->
  <div class="form-group mb-3">
    <label class="form-label fw-bold">Buscar Cliente:</label>
    <input
      type="text"
      class="form-control"
      placeholder="Ingrese Numero de cueta o ID o Nombre del cliente"
      [(ngModel)]="personaBusqueda"
      name="personaBusqueda"
      (input)="buscarPersona()"
    />

    <!-- Resultados de bÃºsqueda -->
    <ul class="list-group mt-2" *ngIf="personasFiltradas.length > 0">
      <li
        class="list-group-item list-group-item-action"
        *ngFor="let p of personasFiltradas"
        (click)="seleccionarPersona(p)"
      >
        {{ p.idPersona }} - {{ p.nombre }} {{ p.apellido }}
      </li>
    </ul>
  </div>

  <!-- Datos de la persona -->
  <div *ngIf="personaSeleccionada" class="mt-4">
    <h5>Cliente Seleccionado:</h5>
    <p><strong>ID:</strong> {{ personaSeleccionada.idPersona }}</p>
    <p>
      <strong>Nombre:</strong> {{ personaSeleccionada.nombre }}
      {{ personaSeleccionada.apellido }}
    </p>
  </div>

  <!-- Tabla de cuentas -->
  <div *ngIf="cuentas.length > 0" class="mt-4">
    <h5>Cuentas del Cliente</h5>
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>NÃºmero de Cuenta</th>
          <th>Tipo Cuenta</th>
          <th>Saldo Inicial</th>
          <th>Cargos (DÃ©bitos)</th>
          <th>Abonos (CrÃ©ditos)</th>
          <th>Saldo Final</th>
          <th>PDF</th>
          <th>EXCEL</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let cuenta of cuentas">
          <td>{{ cuenta.idSaldoCuenta }}</td>
          <td>{{ cuenta.tipoSaldoCuenta.nombre }}</td>
          <td>{{ cuenta.saldoAnterior }}</td>
          <td>{{ cuenta.debitos }}</td>
          <td>{{ cuenta.creditos }}</td>
          <td>{{ cuenta.saldoAnterior + cuenta.debitos - cuenta.creditos }}</td>
          <!--<td>{{ (cuenta.saldoAnterior + cuenta.creditos) - cuenta.debitos }}</td>-->

          <!-- BotÃ³n PDF *ngIf="puedeExportar" -->
          <td>
            <button *ngIf="puedeImprimir" (click)="generarPdf()" class="btn btn-outline-danger ms-2">
              <i class="bi bi-file-pdf"></i> Exportar PDF
            </button>
          </td>
          <!-- BotÃ³n Excel *ngIf="puedeExportar" -->
          <td>
            <button  *ngIf="puedeExportar" (click)="generarExcel()" class="btn btn-outline-success">
              <i class="bi bi-file-excel"></i> Excel
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div
    *ngIf="personaSeleccionada && cuentas.length === 0"
    class="alert alert-warning mt-4"
  >
    El cliente no tiene cuentas registradas.
  </div>
</div>
