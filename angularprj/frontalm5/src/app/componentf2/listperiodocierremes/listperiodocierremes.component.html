<div class="container mt-4">
  <!-- Título -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="text-primary m-0">Gestión de Cierres de Mes</h2>
    <button class="btn btn-success" (click)="mostrarFormulario = !mostrarFormulario">
      <i class="bi bi-plus-circle"></i> Nuevo Periodo
    </button>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="mensaje" class="alert alert-danger">{{ mensaje }}</div>

  <!-- Combo para seleccionar periodo -->
  <div class="card shadow-lg border-0 rounded-3 mb-4">
    <div class="card-body">
      <div class="row align-items-end g-3">
        <div class="col-md-6">
          <label class="form-label fw-bold">Seleccionar Periodo</label>
          <select
            class="form-select"
            [(ngModel)]="periodoSeleccionado"
            name="periodoSeleccionado"
          >
            <option [ngValue]="null">-- Seleccione un periodo --</option>
            <option *ngFor="let p of periodos" [ngValue]="p">
              {{ p.id.anio }} - {{ meses[p.id.mes - 1].nombre }}
              ({{ p.fechaCierre ? 'Cerrado' : 'Pendiente' }})
            </option>
          </select>
        </div>

        <div class="col-md-3" *ngIf="periodoSeleccionado">
          <label class="form-label fw-bold">Estado</label>
          <div>
            <span *ngIf="periodoSeleccionado.fechaCierre; else pendiente" class="badge bg-success">
              Cerrado el {{ periodoSeleccionado.fechaCierre }}
            </span>
            <ng-template #pendiente>
              <span class="badge bg-warning text-dark">Pendiente</span>
            </ng-template>
          </div>
        </div>

        <div class="col-md-3 text-end">
          <button
            class="btn btn-warning me-2"
            (click)="cerrarMes(periodoSeleccionado)"
            [disabled]="!periodoSeleccionado || periodoSeleccionado.fechaCierre"
          >
            <i class="bi bi-lock-fill"></i> Cerrar Mes
          </button>

          <!--
          <button
            class="btn btn-danger"
            (click)="eliminar(periodoSeleccionado)"
            [disabled]="!periodoSeleccionado"
          >
            <i class="bi bi-trash"></i> Eliminar
          </button>
          -->

        </div>
      </div>
    </div>
  </div>

  <!-- Formulario para nuevo periodo -->
  <div *ngIf="mostrarFormulario" class="card mt-4 shadow-lg border-0 rounded-3">
    <div class="card-header bg-primary text-white">
      <h5 class="m-0">Nuevo Periodo</h5>
    </div>
    <div class="card-body">
      <form (ngSubmit)="crearPeriodo()">
        <div class="row g-3">
          <!-- Año -->
          <div class="col-md-3">
            <label class="form-label">Año</label>
            <select class="form-select" [(ngModel)]="nuevo.id.anio" name="anio">
              <option *ngFor="let a of anios" [value]="a">{{ a }}</option>
            </select>
          </div>

          <!-- Mes -->
          <div class="col-md-3">
            <label class="form-label">Mes</label>
            <select
              class="form-select"
              [(ngModel)]="nuevo.id.mes"
              name="mes"
              (change)="calcularFechas()"
            >
              <option *ngFor="let m of meses" [value]="m.value">{{ m.nombre }}</option>
            </select>
          </div>

          <!-- Fecha Inicio -->
          <div class="col-md-3">
            <label class="form-label">Fecha Inicio</label>
            <input
              class="form-control"
              type="date"
              [(ngModel)]="nuevo.fechaInicio"
              name="fechaInicio"
              readonly
            />
          </div>

          <!-- Fecha Final -->
          <div class="col-md-3">
            <label class="form-label">Fecha Final</label>
            <input
              class="form-control"
              type="date"
              [(ngModel)]="nuevo.fechaFinal"
              name="fechaFinal"
              readonly
            />
          </div>
        </div>

        <!-- Botones -->
        <div class="d-flex justify-content-end mt-4">
          <button
            class="btn btn-secondary me-2"
            type="button"
            (click)="mostrarFormulario = false"
          >
            Cancelar
          </button>
          <button class="btn btn-primary" type="submit">
            <i class="bi bi-save"></i> Guardar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
